# 常见索引类型的选择

![mysql-index](https://tva1.sinaimg.cn/large/008i3skNgy1grdkkzp83rj307s050aa0.jpg)

我们知道索索引对于数据库查询的性能有着巨大的影响，选择不同的索引类型同样对于MySQL来说意义重大，目前MySQL支持`B+Tree`、`Hash`、`Full-text`等索引，MySQL的索引是在存储引擎层实现的，不同的存储引擎对于对于相同的索引算法也有不同的实现方式，目前，`InnoDB`存储引擎对这三种索引均有良好的支持，这节课程我们将对常见的索引，针对各自的优势做一个详细的介绍。

## B+Tree索引

InnoDB中非主键索引使用的是B-Tree数据结构，而主键索引使用的是B+Tree。

### B-Tree索引

B-Tree能加快数据的访问速度，因为存储引擎不再需要进行全表扫描来获取数据，数据分布在各个节点之中。

![b-tree](https://tva1.sinaimg.cn/large/008i3skNgy1gt3pc6z8xnj30lp0ar3ys.jpg)

通过上面的额图示，我们可以看出`B-Tree`索引有如下特性：

* `B-Tree`索引能够加快数据的查询速度，通常来说，索引的大小要远远小于数据量的大小。
* `B-Tree`索引更适合进行范围查找。

通过上面的特点，我们可以知道下面几种情况可以使用B-Tree索引：

* 全职匹配的查找
* 匹配最左前缀的查询，如组合索引中最前边的列如果匹配，也能够使用到此索引
* 匹配列前缀查询，比如`name like 'zhang%'`
* 匹配范围值的查询
* 精确匹配左前列并范围匹配另外一列
* 因为B-Tree索引是按照顺序存储的，所以，很适合查找之后的排序

虽然B-Tree索引各方面都很有优异，但是还是有一些限制的地方：

* 太多的索引导致索引的数据量超过表的数据量，查询优化器可能会认为全表扫描更快，从而忽略索引
* 如果不是按照索引最左列开始查找，则无法使用索引
* 使用索引不能跳过索引中的列
* `Not in` 和 `<>`操作无法使用索引
* 如果查询中有某个列的范围查询，则其右边的所有列都无法使用索引 

### B+Tree索引

是B-Tree的改进版本，同时也是数据库索引索引所采用的存储结构。数据都在叶子节点上，并且增加了顺序访问指针，每个叶子节点都指向相邻的叶子节点的地址。相比B-Tree来说，进行范围查找时只需要查找两个节点，进行遍历即可。而B-Tree需要获取所有节点，相比之下B+Tree效率更高。

![b+tree](https://tva1.sinaimg.cn/large/008i3skNgy1gt3pliiw88j30mm0b3gm0.jpg)

在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引，因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。

所以，B+Tree继承了B-Tree的所有特性之外，查询效率将会更高。

## Hash索引

InnoDB本身支持Hash索引，但是此索引不是我们自己指定创建的，而是存储引擎自行建立的，所以也称之为自适应Hash索引。

基于哈希表实现，只有精确匹配索引所有列的查询才有效，对于每一行数据，存储引擎都会对所有的索引列计算一个哈希码（hash code），并且Hash索引将所有的哈希码存储在索引中，同时在索引表中保存指向每个数据行的指针。

![hash-index](https://tva1.sinaimg.cn/large/008i3skNgy1gt3qe51kt2j30r80ckmys.jpg)

Hash索引有以下几个特点：

* 只有查询条件精确匹配Hash索引中的所有列时，才能够使用到此索引，换句话说，Hash索引只能使用到等值查找中。
* Hash索引中存储的是Hash码，这就意味着要通过Hash索引找到数据，必须要经过两次查找才行。
* Hash索引无法用于排序。
* Hash索引中Hash码的计算可能存在Hash冲突

## 全文索引

通过数值比较、范围过滤等就可以完成绝大多数我们需要的查询了。但是，如果你希望通过关键字的匹配来进行查询过滤，那么就需要基于相似度的查询，而不是原来的精确数值比较。全文索引就是为这种场景设计的。

全文索引有着自己独特的语法。其实，没有索引也可以工作，如果有索引，效率会更高。用于全文搜索的索引有着独特的结构，帮助这类查询找到匹配某些关键字的记录。

你可能没有在意过全文索引，不过至少应该对一种全文索引技术比较熟悉：互联网搜索引擎。虽然这类搜索引擎对象都是超大量的数据，并且通常其背后都不是关系型数据库。不过全文索引的基本原理都是一样的。

全文索引可以支持各种字符内容的搜索(包括CHAR、VARCHAR和TEXT类型)，也支持自然语言搜索和布尔的搜索。

全文索引应用也比较广泛，但是我们这里不做深入的介绍，有兴趣的同学可以找找其他资料进一步学习！


